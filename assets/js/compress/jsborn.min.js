(function(k){var l="on",m="off";7>jQuery.fn.jquery.split(".")[1]&&(l="bind",m="unbind");var a={version:"0.5a",event:{on:l,off:m},data:{cores:{},clss:{},plugins:{},imports:[]},config:{console:!0,createImport:!1,extendPlugins:[],importSetup:{ext:[".js"],library:"",source:"",parserURL:function(d){var b="";if(d.match(/^(http|https):\/\//g))b=d.match(/^(https|http):\/\/(.*?)\//g)[0].replace(/(https|http|:|\/)/g,""),b!=k.location.hostname&&a.echo("error","imports need sample domain",d),b=d;else for(var c=
d.replace(/\\/g,"/").replace(/.*\//,""),f=0;f<a.config.importSetup.ext.length;f++){var e=a.config.importSetup.ext[f];if(c.substr(c.length,-e.length)!=e){b=d.replace(/\./g,"/");b=-1==d.match(/^jsborn\./g)?a.config.importSetup.library+b+e:a.config.importSetup.source+b+e;break}else b=d}return b}}},addListener:function(d,b,c){jQuery(a)[a.event.on]("jsb."+d,{scope:c},b)},create:function(d,b){a.config.createImport&&this._check_class(d);var c=a.getClass(d);if(!c)return a.echo("error","NO CLASS:"+d),!1;if(c.config.abstr)return a.echo("error",
"CLASS:ABSTR can't create",d),!1;c.config.nodes||(c.config.nodes=[]);if(c.config.single&&0<c.config.nodes.length)return a.echo("error","CLASS:SINGLE",d),!1;var f=new c.cls(b);c.config.nodes.push(f);jQuery(a).triggerHandler("jsb.create",f);return f},echo:function(d){if(console&&a.config.console)if(console[d]){for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);console[d](b)}else a.echo("log","console no "+d+" method.")},extendCore:function(d,b){a.core||(a.core={});var c=b.config.name;if(a.getCore(c))return a.echo("log",
"Core: "+c+" already register."),a.getCore(c);b.config=jQuery.extend(b.config,{single:!0,abstr:!1,plugin:!1,core:!0});a.core[d]=a.create(c);a.data.cores[c]=a.core[d];return a.core[d]},extendPlugin:function(d){var b=d.cls.prototype.depends,c=d.config.name;if(a.getPlugin(c))return a.echo("log","Plugin: "+d+" already register."),a.getPlugin(c);if(jQuery.isArray(b))for(var f=0;f<b.length;f++)this._check_class(b[f])||a.echo("error","PLUGINS:"+c+" depends CLASS:"+b[f]+" not found");d.config=jQuery.extend(d.config,
{single:!0,abstr:!1,plugin:!0,core:!1});a.data.plugins[c]=a.create(c);return a.data.plugins[c]},getCore:function(a){return this.data.cores[a]?this.data.cores[a]:!1},getClass:function(a){return this.data.clss[a]?this.data.clss[a]:!1},getClassData:function(){return this.data.clss},getPlugin:function(a){return this.data.plugins[a]?this.data.plugins[a]:!1},getImportData:function(){return this.data.imports},importClass:function(d){var b="",c=!0;if(a._check_import(d))return!0;b=a.config.importSetup.parserURL(d);
jQuery.ajax({url:b,dataType:"script",async:!1,error:function(d,e,g){c=!1;a.echo("error","Require:"+b+" Message:"+g)},success:function(){a.data.imports.push({name:b,status:c})}});return c},removeListener:function(d){jQuery(a).off("jsb."+d)},setConfig:function(a){jQuery.extend(!0,this.config,a);return this.config},_check_import:function(d){for(var b=0;b<a.data.imports.length;b++)if(a.data.imports[b].name==d)return a.echo("log","same",a.data.imports[b],d),!0;return!1},_check_class:function(a){return this.getClass(a)?
!0:this.importClass(a)},_init:function(){this._init_oop()},_init_oop:function(){var d=this;a.cls=function(b,c){if(d.getClass(b))return a.echo("error","CLASS:'"+b+"' define again"),!0;var f=function(e){var g=this.extend;g&&(a._check_class(g),jQuery.extend(f.prototype,a.cls.prototype,a.getClass(g).cls.prototype,c));g=d.getClass(b);c.plugins=c.plugins?c.plugins:[];this.plugins=this.plugins?this.plugins:[];this.plugins=jQuery.merge(this.plugins,c.plugins);if(!g.config.plugin&&!g.config.core){this.plugins=
jQuery.merge(this.plugins,a.config.extendPlugins);var h=[];jQuery.each(this.plugins,function(a,b){-1==jQuery.inArray(b,h)&&h.push(b)});this.plugins=h}this._name=b;this._count=0;this._destroy=!1;this._ary_extend=[];this._ary_plugin=[];this._plugin_init(f);this._extend(this);this._import();this.initialize(e);this.SUPER();delete this._count;return!0};jQuery.extend(f.prototype,a.cls.prototype,c);!0!==c.single&&(c.single=!1);!0!==c.abstr&&(c.abstr=!1);d.data.clss[b]={config:{name:b,single:c.single,abstr:c.abstr,
plugin:!1,core:!1},cls:f};return d.data.clss[b]};a.cls.prototype={extend:"",_ary_extend:[],_ary_plugin:[],_plugin_init:function(b){var c=this.plugins,d;if(c){for(var e=0;e<c.length;e++)a._check_class(c[e]),d=a.getClass(c[e]).cls.prototype,this._ary_plugin.push(c[e]),this._plugin(d);for(e=0;e<this._ary_plugin.length;e++)d=a.getClass(this._ary_plugin[e]).cls.prototype,jQuery.extend(b.prototype,a.getPlugin(this._ary_plugin[e]).getPrototype()),d.initialize.call(this)}},_plugin:function(b){if(b=b.depends)for(var c=
0;c<b.length;c++){var d=b[c],e=a.getClass(d);e.config.plugin&&(this._ary_plugin.push(d),e.cls.prototype.depends&&this._plugin(e.cls.prototype))}},_extend:function(b){var c=b.extend;c&&(this._ary_extend.push(b.extend),b=a.getClass(c).cls,b.prototype.extend&&this._extend(b.prototype))},_import:function(){if(this.imports)for(var b=0;b<this.imports.length;b++)a._check_class(this.imports[b])},SUPER:function(){if(0<this._ary_extend.length&&this._count<this._ary_extend.length){var b=this._ary_extend[this._count];
b&&(b=a.getClass(b).cls.prototype,this._count++,b._import(),b.initialize.apply(this),b.extend&&this.SUPER())}},destroy:function(){if(this._destroy)return a.echo("error",this,"already destroy"),!0;for(var b=a.getClass(this._name),c=0;c<b.config.nodes.length;c++)b.config.nodes[c]==this&&b.config.nodes.splice(c,1);jQuery(this).triggerHandler("cls.destroy",this);jQuery(a).triggerHandler("jsb.destroy",this);this._destroy=!0;return this},addListener:function(b,c,d){jQuery(this)[a.event.on]("cls."+b,{scope:d},
c)},dispatchEvent:function(b,a){jQuery(this).triggerHandler("cls."+b,this,a)},removeListener:function(b){jQuery(this)[a.event.off]("cls."+b)},initialize:function(){}}}};a._init();k.JSB=a})(window);